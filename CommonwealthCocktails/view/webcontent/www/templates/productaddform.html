{{define "base"}}
<!DOCTYPE html>
<html lang="en">

<head>

    {{template "head" .}}

</head>

<body>
    {{template "navbar" .}}
    <!-- Page Content -->
    <div class="container">
        <div class="page-header">
        </div>
        <div class="row">
            <div class="col-xs-12">
                <div class="row">
                    <h1 align="center">Product Modification Form</h1>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12">
                <div class="row">
                    {{template "productSelect" .}}
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12">
                <div class="row">
                    <form action="/productAdd" id="productAddForm" autocomplete="nope">
                        {{template "productName" .}}
                        <!---->
                        {{template "productType" .}}
                        <!---->
                        {{template "productDescription" .}}
                        <!---->
                        {{template "productDetails" .}}
                        <!---->
                        {{template "productImage" .}}
                        <!---->
                        {{template "productImageSourceName" .}}
                        <!---->
                        {{template "productImageSourceLink" .}}
                        <!---->
                        {{template "productPreText" .}}
                        <!---->
                        {{template "productPostText" .}}
                        <!---->
                        {{template "productRating" .}}
                        <!---->
                        {{template "productSourceName" .}}
                        <!---->
                        {{template "productSourceLink" .}}
                        <!---->
                    </form>
                    <script>
                        $(window).bind("pageshow", function() {
                            $('#productAddForm')[0].reset();
                            {{range .ProductsByTypes.PBT}}
                            {{if ne .ProductType.ProductTypeName $.Product.ProductType.ProductTypeName }}
                            $('#productGroupType{{.ProductType.ProductTypeName}}').val('Base');
                            $('#productGroupType{{.ProductType.ProductTypeName}}div')
                                .addClass('hide');
                            var derived = $('#derived{{.ProductType.ProductTypeName}}div');
                            derived
                                .addClass('hide');
                            var group = $('#group{{.ProductType.ProductTypeName}}div');
                            group
                                .addClass('hide');
                            {{end}}
                            {{end}}
                        });
                    </script>
                    <div style="text-align: center;">
                        <button type="submit" form="productAddForm" class="btn btn-default">Submit</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- /.container -->
    {{template "footer" .}}
</body>

</html>
{{end}}


{{define "productSelect"}}
<div class="row">
    <div class=" col-xs-1"></div>
    <div class=" col-xs-10 form-group">
        <label for="metaSelect">Select Product</label>
        <select class="form-control" id="productSelect" name="metaSelect">
            <option></option>
            {{range .ProductsByTypes.PBT}}
            {{$prodType:=.ProductType}}
            {{range .Products}}
            <option value="{{.ID}}">{{$prodType.ProductTypeName}} - {{.ProductName}}</option>
            {{end}}
            {{end}}
        </select>
    </div>
    <script>
        $(function() {
            // bind change event to select
            $('#productSelect').on('change', function() {
                var id = $(this).val(); // get selected value
                if (id) { // require a URL
                    window.location = "/productAddForm?ID="+id; // redirect
                }
                return false;
            });
        });
    </script>
    <div class=" col-xs-1"></div>
</div>
{{end}}

<!--ProductName      string-->
{{define "productName"}}
<div class="row">
    <div class=" col-xs-1"></div>
    <div class=" col-xs-10 form-group">
        <label for="productName">Product Name</label>
        {{ with .Errors.productName }}
        <div class="alert alert-danger" role="alert">
          <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
          <span class="sr-only">Error:</span>
          {{.}}
        </div>
        {{ end }}
        <input type="text" class="form-control" id="productName" name="productName" value="{{$.Product.ProductName}}">
    </div>
    <div class=" col-xs-1"></div>
</div>
{{end}}
<!--ProductType      ProductType-->
{{define "productType"}}
<div class="row">
    <div class=" col-xs-1"></div>
    <div class=" col-xs-10 ">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h2 class="panel-title">Product Type / Product Group Type</h2>
            </div>
            <div class="panel-body">
                <div class="form-group">
                    <div class="col-xs-12">
                        <label for="productType">Product Type</label>
                        <select class="form-control" id="productType" name="productType">
                            <option selected>&nbsp;</option>
                            <!--loop over all types and add option-->
                            {{range .ProductsByTypes.PBT}}
                            {{if eq .ProductType.ProductTypeName $.Product.ProductType.ProductTypeName }}
                            <option selected>{{.ProductType.ProductTypeName}}</option>
                            {{else}}
                            <option>{{.ProductType.ProductTypeName}}</option>
                            {{end}}
                            {{end}}
                        </select>
                    </div>
                    <div class="col-xs-12">&nbsp;</div>
                </div>
                
                <!--loop over all type and add a group type for that type-->
                {{template "productGroupType" .}}
                <!---->
            </div>
        </div>
        <script>
            $(document).ready(function() {
                $('#productType')
                    // Add change handler
                    .change(function() {
                        // Hide all the group types for all types
                        // loop over all types
                        {{range .ProductsByTypes.PBT}}
                            $('#productGroupType{{.ProductType.ProductTypeName}}').val('Base');
                            $('#productGroupType{{.ProductType.ProductTypeName}}div')
                                .addClass('hide');
                            var derived = $('#derived{{.ProductType.ProductTypeName}}div');
                            derived
                                .addClass('hide');
                            $('#derived{{.ProductType.ProductTypeName}} option').prop('selected', false);
                            var group = $('#group{{.ProductType.ProductTypeName}}div');
                            group
                                .addClass('hide');
                            $('#group{{.ProductType.ProductTypeName}} option').prop('selected', false);
                        {{end}}
                        //check for the type and unhide the group type
                        //each if is a type, loop over all types and create
                        //an if for each type
                        {{range .ProductsByTypes.PBT}}
                        if ($("#productType :selected").text() == "{{.ProductType.ProductTypeName}}") {
                            $('#productGroupType{{.ProductType.ProductTypeName}}div')
                                .removeClass('hide');
                        }
                       {{end}}
                    });
            });
        </script>

    </div>
    <div class=" col-xs-1"></div>
</div>
{{end}}
<!--Description      template.HTML-->
{{define "productDescription"}}
<div class="row">
    <div class=" col-xs-1"></div>
    <div class=" col-xs-10 form-group">
        <label for="productDescription">Product Description</label>
        <div class=" col-xs-12"></div>
        <textarea id="productDescription" class="form-control" rows="3" name="productDescription"></textarea>
        <script>
            $(document).ready(function() {
                $('#productDescription').summernote({
                  toolbar: [
                    ['style', ['style']],
                    ['font', ['bold', 'italic', 'underline', 'clear']],
                    ['fontsize', ['fontsize']],
                    ['view', ['fullscreen', 'codeview']],
                  ]
                });
            });
        </script>
    </div>
    <div class=" col-xs-1"></div>
</div>
{{end}}
<!--Details          template.HTML-->
{{define "productDetails"}}
<div class="row">
    <div class=" col-xs-1"></div>
    <div class=" col-xs-10 form-group">
        <label for="productDetails">Product Details</label>
        <div class=" col-xs-12"></div>
        <textarea id="productDetails" class="form-control" rows="3" name="productDetails"></textarea>
        <script>
            $(document).ready(function() {
                $('#productDetails').summernote({
                  toolbar: [
                    ['style', ['style']],
                    ['font', ['bold', 'italic', 'underline', 'clear']],
                    ['fontsize', ['fontsize']],
                    ['view', ['fullscreen', 'codeview']],
                  ]
                });
            });
        </script>
    </div>
    <div class=" col-xs-1"></div>
</div>
{{end}}
<!--ImagePath        string-->
<!--Image            string-->
{{define "productImage"}}
<div class="row">
    <div class=" col-xs-1"></div>
    <div class=" col-xs-10 form-group">
        <label for="productImage">Product Image</label>
        <input type="text" class="form-control" id="productImage" name="productImage">
        <div style="text-align: center;"><img style="display: none;" height="200" width="200" id='productImagePreview' /></div>
        <script>
            $(document).ready(function() {
                function readURL(input) {
                    if (input.value != null) {
                        $('#productImagePreview').attr('src', input.value);
                        $('#productImagePreview').toggle();
                    }
                    else {
                        $('#productImagePreview').toggle();
                    }
                }
                $("#productImage").change(function() {
                    readURL(this);
                });
            });
        </script>
    </div>
    <div class=" col-xs-1"></div>
</div>
{{end}}
<!--ImageSourceName string-->
{{define "productImageSourceName"}}
<div class="row">
    <div class=" col-xs-1"></div>
    <div class=" col-xs-10 form-group">
        <label for="productImageSourceName">Product Image Source Name</label>
        <input type="text" class="form-control" id="productImageSourceName" name="productImageSourceName">
    </div>
    <div class=" col-xs-1"></div>
</div>
{{end}}
<!--ImageSourceLink string-->
{{define "productImageSourceLink"}}
<div class="row">
    <div class=" col-xs-1"></div>
    <div class=" col-xs-10 form-group">
        <label for="productImageSourceLink">Product Image Source Link</label>
        <input type="text" class="form-control" id="productImageSourceLink" name="productImageSourceLink">
        <div style="text-align: center;"><img style="display: none;" height="200" width="200" id='productImageSourceLinkPreview' /></div>
        <script>
            $(document).ready(function() {
                function readURL(input) {
                    if (input.value != null) {
                        $('#productImageSourceLinkPreview').attr('src', input.value);
                        $('#productImageSourceLinkPreview').toggle();
                    }
                    else {
                        $('#productImageSourceLinkPreview').toggle();
                    }
                }
                $("#productImageSourceLink").change(function() {
                    readURL(this);
                });
            });
        </script>
    </div>
    <div class=" col-xs-1"></div>
</div>
{{end}}
<!--Article          Post-->
<!--Recipe           Recipe-->
<!--ProductGroupType GroupType-->
{{define "productGroupType"}}
{{range .ProductsByTypes.PBT}}
{{if eq .ProductType.ProductTypeName $.Product.ProductType.ProductTypeName}}
<div class="form-group" id="productGroupType{{.ProductType.ProductTypeName}}div">
{{else}}
<div class="form-group hide" id="productGroupType{{.ProductType.ProductTypeName}}div">
{{end}}
    <div class="col-xs-12">
        <label for="productGroupType{{.ProductType.ProductTypeName}}">Product Group Type</label>
        <select class="form-control" id="productGroupType{{.ProductType.ProductTypeName}}" name="productGroupType{{.ProductType.ProductTypeName}}">
            <option value='Base' selected>Base</option>
            {{if and (eq .ProductType.ProductTypeName $.Product.ProductType.ProductTypeName) (eq 2 $.Product.ProductGroupType)}}
            <option value='Derived' selected>Derived</option>
            {{else}}
            <option value='Derived'>Derived</option>
            {{end}}
            {{if and (eq .ProductType.ProductTypeName $.Product.ProductType.ProductTypeName) (eq 3 $.Product.ProductGroupType)}}
            <option value='Group' selected>Group</option>
            {{else}}
            <option value='Group'>Group</option>
            {{end}}
        </select>
    </div>
</div>


<!-- The template for adding new field -->
{{if and (eq .ProductType.ProductTypeName $.Product.ProductType.ProductTypeName) (eq 2 $.Product.ProductGroupType)}}
<div class="form-group" id="derived{{.ProductType.ProductTypeName}}div">
{{else}}
<div class="form-group hide" id="derived{{.ProductType.ProductTypeName}}div">
{{end}}
    <div class="col-xs-12">&nbsp;</div>
    <div class="col-xs-12">
        <select class="form-control" id="derived{{.ProductType.ProductTypeName}}" name="derived{{.ProductType.ProductTypeName}}">
            {{range .Products}}
            <option value="{{.ID}},">{{.ProductName}}</option>
            {{end}}
        </select>
    </div>
    <div class="col-xs-12">&nbsp;</div>
</div>

{{if and (eq .ProductType.ProductTypeName $.Product.ProductType.ProductTypeName) (eq 3 $.Product.ProductGroupType)}}
<div class="form-group" id="group{{.ProductType.ProductTypeName}}div">
{{else}}
<div class="form-group hide" id="group{{.ProductType.ProductTypeName}}div">
{{end}}
    <div class="col-xs-12">&nbsp;</div>
    <div class="col-xs-12">
        <select class="form-control" id="group{{.ProductType.ProductTypeName}}" name="group{{.ProductType.ProductTypeName}}" multiple="multiple" size="5">
            {{range .Products}}
            <option value="{{.ID}},">{{.ProductName}}</option>
            {{end}}
        </select>
    </div>
    <div class="col-xs-12">&nbsp;</div>
</div>
<script>
    $(document).ready(function() {
        $('#productGroupType{{.ProductType.ProductTypeName}}')
            // Add change handler
            .change(function() {
                if ($("#productGroupType{{.ProductType.ProductTypeName}} :selected").text() == "Base") {
                    var derived = $('#derived{{.ProductType.ProductTypeName}}div');
                    derived
                        .addClass('hide');
                    var group = $('#group{{.ProductType.ProductTypeName}}div');
                    group
                        .addClass('hide');
                }
                else if ($("#productGroupType{{.ProductType.ProductTypeName}} :selected").text() == "Derived") {
                    var derived = $('#derived{{.ProductType.ProductTypeName}}div');
                    derived
                        .removeClass('hide');
                    var group = $('#group{{.ProductType.ProductTypeName}}div');
                    group
                        .addClass('hide');
                }
                else if ($("#productGroupType{{.ProductType.ProductTypeName}} :selected").text() == "Group") {
                    var derived = $('#derived{{.ProductType.ProductTypeName}}div');
                    derived
                        .addClass('hide');
                    var group = $('#group{{.ProductType.ProductTypeName}}div');
                    group
                        .removeClass('hide');
                }
                console.log($("#productGroupType{{.ProductType.ProductTypeName}} :selected").text());
            });
    });
</script>
<div class=" col-xs-1"></div>
{{end}}
{{end}}
<!--PreText          string-->
{{define "productPreText"}}
<div class="row">
    <div class=" col-xs-1"></div>
    <div class=" col-xs-10 form-group">
        <label for="productPreText">Product Name Pre-Text</label>
        <input type="text" class="form-control" id="productPreText" name="productPreText">
    </div>
    <div class=" col-xs-1"></div>
</div>
{{end}}
<!--PostText         string-->
{{define "productPostText"}}
<div class="row">
    <div class=" col-xs-1"></div>
    <div class=" col-xs-10 form-group">
        <label for="productPostText">Product Name Post-Text</label>
        <input type="text" class="form-control" id="productPostText" name="productPostText">
    </div>
    <div class=" col-xs-1"></div>
</div>
{{end}}
<!--Drink            []Meta-->
<!--Rating           int-->
{{define "productRating"}}
<div class="row">
    <div class=" col-xs-1"></div>
    <div class=" col-xs-10 form-group">
        <label for="productRating">Product Rating</label>
        <input type="text" class="form-control" id="productRating" name="productRating">
    </div>
    <div class=" col-xs-1"></div>
</div>
{{end}}
<!--SourceName      string-->
{{define "productSourceName"}}
<div class="row">
    <div class=" col-xs-1"></div>
    <div class=" col-xs-10 form-group">
        <label for="productSourceName">Product Source Name</label>
        <input type="text" class="form-control" id="productSourceName" name="productSourceName">
    </div>
    <div class=" col-xs-1"></div>
</div>
{{end}}
<!--SourceLink      string-->
{{define "productSourceLink"}}
<div class="row">
    <div class=" col-xs-1"></div>
    <div class=" col-xs-10 form-group">
        <label for="productSourceLink">Product Source Link</label>
        <input type="text" class="form-control" id="productSourceLink" name="productSourceLink">
    </div>
    <div class=" col-xs-1"></div>
</div>
{{end}}
<!--About            Post-->
